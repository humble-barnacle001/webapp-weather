const storage=new Storage;storage.get();const weather=new Weather(storage.city),ui=new UI,ac=new Autocomplete;let currentRES;function initial(){const srchString=window.location.search.substring(window.location.search.indexOf("=")+1).toLowerCase();""!=srchString?(changeLoc(srchString),setTimeout(()=>window.history.pushState(srchString,`Weather of ${srchString}`,"/"),3e3)):document.addEventListener("DOMContentLoaded",getWeather),"light"==storage.theme?lightThemeSet():darkThemeSet(),document.getElementById("themeChanger").addEventListener("click",e=>{e.preventDefault(),changeTheme()}),document.querySelector(".toTop").addEventListener("click",()=>window.scrollTo(0,0)),document.getElementById("top-alert-closer").addEventListener("click",()=>ui.closeAlert()),document.getElementById("btnDetails").addEventListener("click",e=>ui.paintDetails(e,currentRES,storage)),document.getElementById("btnClsDetails").addEventListener("click",()=>ui.removeDetails()),document.getElementById("tmp-form").addEventListener("submit",changeTmpUnit),document.getElementById("tmpChangeBtn").addEventListener("click",changeTmpUnit),document.addEventListener("scroll",()=>{window.scrollY>100?document.querySelector(".toTop").style.opacity="0.74":document.querySelector(".toTop").style.opacity="0"}),$("#locModal").on("hidden.bs.modal",()=>ui.resetSrchUI())}function changeTheme(){"css/light.css"===document.getElementById("theme").getAttribute("href")?darkThemeSet():lightThemeSet()}function darkThemeSet(){document.getElementById("theme").setAttribute("href","css/dark.css"),document.getElementById("themeChanger").setAttribute("fill","#fff"),storage.setTheme("dark")}function lightThemeSet(){document.getElementById("theme").setAttribute("href","css/light.css"),document.getElementById("themeChanger").setAttribute("fill","#333"),storage.setTheme("light")}function changeLoc(e){let prev=weather.city;"object"==typeof e?(e.preventDefault(),weather.changeLocation(document.getElementById("city").value)):weather.changeLocation(e),weather.getWeather().then(res=>{res.error?(ui.paintAlert(weather.city),"object"!=e&&changeLoc(prev),weather.changeLocation(prev),storage.setLocation(prev)):(ui.paint(res,storage),currentRES=res,storage.setLocation(weather.city))}).catch(err=>console.error(err)),$("#locModal").modal("hide")}function changeTmpUnit(){document.getElementById("unitC").checked?(ui.changeTmpUnit("C",currentRES),storage.setTempUnit("C")):(ui.changeTmpUnit("F",currentRES),storage.setTempUnit("F")),$("#locModal1").modal("hide")}function getWeather(){weather.getWeather().then(res=>{res.error?ui.paintAlert(weather.city):(ui.paint(res,storage),currentRES=res)}).catch(err=>console.error(err))}initial(),document.getElementById("city").addEventListener("keyup",()=>ac.getResults()),document.getElementById("srchSugg").addEventListener("click",e=>{e.preventDefault(),ac.getcityName(e.target.getAttribute("data-link")).then(r=>changeLoc(`${r.location.latlon.latitude},${r.location.latlon.longitude}`)).catch(err=>console.warn(err))});